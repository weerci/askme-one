; Script generated by the Inno Setup Script Wizard.
; SEE THE DOCUMENTATION FOR DETAILS ON CREATING INNO SETUP SCRIPT FILES!

#define MyAppName "Askme"
#define MyAppVersion "2.0.0.0"
#define MyAppPublisher "CoreLab"
#define MyAppURL "http://code.google.com/p/askme-one/downloads/list"
#define MyAppExeName "Askme.exe"
#define MyAppID "A1E243A3-C2AB-496D-B9D3-BD69125ED4D8"

[Setup]
WizardSmallImageFile=D:\datadi\programming\src\askme-one\res\earth_arrow.bmp
WizardImageFile=D:\datadi\programming\src\askme-one\res\earth_arrow.bmp
; NOTE: The value of AppId uniquely identifies this application.
; Do not use the same AppId value in installers for other applications.
; (To generate a new GUID, click Tools | Generate GUID inside the IDE.)
AppId={#MyAppID}
AppName={#MyAppName}
AppVersion={#MyAppVersion}
AppPublisher={#MyAppPublisher}
AppPublisherURL={#MyAppURL}
AppSupportURL={#MyAppURL}
AppUpdatesURL={#MyAppURL}
DefaultDirName={pf}\Askme
DefaultGroupName=Askme
OutputDir=D:\datadi\programming\exe\askme-one
SourceDir=D:\datadi\programming\exe\askme-one
OutputBaseFilename=askme-one_v2_0
SetupIconFile=D:\datadi\programming\src\askme-one\Go.ico
UninstallDisplayIcon={app}\Askme.exe
Compression=lzma
SolidCompression=true

[Tasks]
Name: desktopicon; Description: {cm:CreateDesktopIcon}; GroupDescription: {cm:AdditionalIcons}; 
Name: quicklaunchicon; Description: {cm:CreateQuickLaunchIcon}; GroupDescription: {cm:AdditionalIcons}; Flags: unchecked

[Files]
Source: ISAlliance.dll; DestDir: {app};
Source: Askme.exe; DestDir: {app}; Flags: ignoreversion
Source: Askme.chm; DestDir: {app}; Flags: ignoreversion
Source: ICSharpCode.SharpZipLib.dll; DestDir: {app}; Flags: ignoreversion
Source: sysprop.dmp; DestDir: {app}; Flags: onlyifdoesntexist
Source: office\Codes_base.xlsx; DestDir: {app}\office; Flags: onlyifdoesntexist
Source: convert\ChkCountChanel.xslt; DestDir: {app}\convert; Flags: ignoreversion
Source: convert\extractXlsxData.xslt; DestDir: {app}\convert; Flags: ignoreversion
Source: convert\ora_xslt.xslt; DestDir: {app}\convert; Flags: ignoreversion
Source: convert\xslt_result.xslt; DestDir: {app}\convert; Flags: ignoreversion
Source: convert\xslToRow.xslt; DestDir: {app}\convert; Flags: ignoreversion
Source: Devart.Data.Oracle.dll; DestDir: {app}; Flags: ignoreversion
Source: Devart.Data.dll; DestDir: {app}; Flags: ignoreversion

[Icons]
Name: {group}\Askme; Filename: {app}\Askme.exe
;Name: {group}\{cm:UninstallProgram,Askme}; Filename: {uninstallexe}
Name: {commondesktop}\Askme; Filename: {app}\Askme.exe; Tasks: desktopicon
Name: {userappdata}\Microsoft\Internet Explorer\Quick Launch\Askme; Filename: {app}\Askme.exe; Tasks: quicklaunchicon

[Run]
Filename: {app}\Askme.exe; Description: {cm:LaunchProgram,Askme}; Flags: nowait postinstall skipifsilent
Filename: "dummy"; Description: "Загружать программу при старте ОС"; Flags: postinstall nowait skipifdoesntexist

[Dirs]
Name: {app}\resultFile; Flags: uninsalwaysuninstall
[UninstallDelete]
Name: {app}; Type: filesandordirs
[Code]
{ RedesignWizardFormBegin } // Не удалять эту строку!
// Не изменять эту секцию. Она создана автоматически.
procedure RedesignWizardForm;
begin
  with WizardForm.WizardBitmapImage do
  begin
    Height := ScaleY(178);
  end;

  with WizardForm.WizardSmallBitmapImage do
  begin
    Height := ScaleY(53);
  end;

  with WizardForm.WizardBitmapImage2 do
  begin
    Height := ScaleY(178);
  end;

{ ReservationBegin }
  // Вы можете добавить ваш код здесь.

{ ReservationEnd }
end;
// Не изменять эту секцию. Она создана автоматически.
{ RedesignWizardFormEnd } // Не удалять эту строку!

procedure InitializeWizard();
begin
  RedesignWizardForm;
end;

procedure KillProc(lpProcName: AnsiString); external 'KillProcess@{app}\ISAlliance.dll stdcall delayload uninstallonly';

procedure CurStepChanged(CurStep: TSetupStep);
var r: Integer;
begin
    if CurStep = ssInstall then
    begin
        Exec(ExpandConstant('{app}\unins000.exe'), '/VERYSILENT /SUPPRESSMSGBOXES', '', SW_SHOW, ewWaitUntilTerminated, r);
        // Дожидаемся завершения удаления...
        while CheckForMutexes('{#MyAppName}Mutex') do Sleep(100);
    end;

    if CurStep = ssDone then
        if WizardForm.RunList.Checked[1] then
            CreateShellLink(ExpandConstant('{userstartup}\{#MyAppName}.lnk'),
                            '',
                            ExpandConstant('{app}\{#MyAppExeName}'),
                            '',
                            ExpandConstant('{app}'),
                            '',
                            0,
                            SW_SHOW);
end;

procedure CurUninstallStepChanged(CurUninstallStep: TUninstallStep);
begin
  if CurUninstallStep = usUninstall then
  begin
    UnloadDLL(ExpandConstant('{app}\ISAlliance.dll'));
  end;
    if CurUninstallStep = usDone then
        DeleteFile(ExpandConstant('{userstartup}\{#MyAppName}.lnk'));
end;

function InitializeUninstall(): Boolean;
begin
  KillProc('{#MyAppExeName}');
  Result := true;
end;

[ISFormDesigner]
WizardForm=FF0A005457495A415244464F524D003010B805000054504630F10B5457697A617264466F726D0A57697A617264466F726D0C436C69656E744865696768740368010B436C69656E74576964746803F1010C4578706C696369744C65667402000B4578706C69636974546F7002000D4578706C6963697457696474680301020E4578706C69636974486569676874038E010D506978656C73506572496E636802600A54657874486569676874020D00F10C544E65774E6F7465626F6F6B0D4F757465724E6F7465626F6F6B00F110544E65774E6F7465626F6F6B506167650B57656C636F6D65506167650D4578706C69636974576964746803F1010E4578706C6963697448656967687403390100F10C544269746D6170496D6167651157697A6172644269746D6170496D6167650648656967687403B2000E4578706C6963697448656967687403B200000000F110544E65774E6F7465626F6F6B5061676509496E6E6572506167650D4578706C69636974576964746803F1010E4578706C6963697448656967687403390100F10C544E65774E6F7465626F6F6B0D496E6E65724E6F7465626F6F6B00F110544E65774E6F7465626F6F6B506167650B4C6963656E7365506167650D4578706C69636974576964746803A1010E4578706C6963697448656967687403ED000000F110544E65774E6F7465626F6F6B506167650C50617373776F7264506167650D4578706C69636974576964746803A1010E4578706C6963697448656967687403ED000000F110544E65774E6F7465626F6F6B506167650E496E666F4265666F7265506167650D4578706C69636974576964746803A1010E4578706C6963697448656967687403ED000000F110544E65774E6F7465626F6F6B506167650C55736572496E666F506167650D4578706C69636974576964746803A1010E4578706C6963697448656967687403ED000000F110544E65774E6F7465626F6F6B506167650D53656C656374446972506167650D4578706C69636974576964746803A1010E4578706C6963697448656967687403ED000000F110544E65774E6F7465626F6F6B506167651453656C656374436F6D706F6E656E7473506167650D4578706C69636974576964746803A1010E4578706C6963697448656967687403ED000000F110544E65774E6F7465626F6F6B506167651653656C65637450726F6772616D47726F7570506167650D4578706C69636974576964746803A1010E4578706C6963697448656967687403ED000000F110544E65774E6F7465626F6F6B506167650F53656C6563745461736B73506167650D4578706C69636974576964746803A1010E4578706C6963697448656967687403ED000000F110544E65774E6F7465626F6F6B50616765095265616479506167650D4578706C69636974576964746803A1010E4578706C6963697448656967687403ED000000F110544E65774E6F7465626F6F6B506167650D507265706172696E67506167650D4578706C69636974576964746803A1010E4578706C6963697448656967687403ED000000F110544E65774E6F7465626F6F6B506167650E496E7374616C6C696E67506167650D4578706C69636974576964746803A1010E4578706C6963697448656967687403ED000000F110544E65774E6F7465626F6F6B506167650D496E666F4166746572506167650D4578706C69636974576964746803A1010E4578706C6963697448656967687403ED00000000F1065450616E656C094D61696E50616E656C00F10C544269746D6170496D6167651657697A617264536D616C6C4269746D6170496D6167650648656967687402350E4578706C69636974486569676874023500000000F110544E65774E6F7465626F6F6B506167650C46696E6973686564506167650D4578706C69636974576964746803F1010E4578706C6963697448656967687403390100F10C544269746D6170496D6167651257697A6172644269746D6170496D616765320648656967687403B2000E4578706C6963697448656967687403B2000000000000


